<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 HPC (M3) Documentation | Analysis Buffer</title>
<meta name="author" content="Patrick Li">
<meta name="description" content="This is a chapter for documenting the use of HPC in terms of folder structure, model setup, tasks submission, etc.  6.1 Help and Support Encounter network issues? Check the system stauts on...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Chapter 6 HPC (M3) Documentation | Analysis Buffer">
<meta property="og:type" content="book">
<meta property="og:url" content="https://someurl.netlify.app/hpc-m3-documentation.html">
<meta property="og:description" content="This is a chapter for documenting the use of HPC in terms of folder structure, model setup, tasks submission, etc.  6.1 Help and Support Encounter network issues? Check the system stauts on...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 HPC (M3) Documentation | Analysis Buffer">
<meta name="twitter:description" content="This is a chapter for documenting the use of HPC in terms of folder structure, model setup, tasks submission, etc.  6.1 Help and Support Encounter network issues? Check the system stauts on...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Analysis Buffer</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="check-the-performance-of-conventional-tests-and-visual-tests-in-detecting-model-violations.html"><span class="header-section-number">1</span> Check the performance of conventional tests and visual tests in detecting model violations</a></li>
<li><a class="" href="conventional-combine-tests.html"><span class="header-section-number">2</span> Conventional combine tests</a></li>
<li><a class="" href="combined-tests-reset-bp-and-sw.html"><span class="header-section-number">3</span> Combined tests (RESET, BP and SW)</a></li>
<li><a class="" href="automatic-visual-inference-system.html"><span class="header-section-number">4</span> Automatic Visual Inference System</a></li>
<li><a class="" href="plan.html"><span class="header-section-number">5</span> Plan</a></li>
<li><a class="active" href="hpc-m3-documentation.html"><span class="header-section-number">6</span> HPC (M3) Documentation</a></li>
<li><a class="" href="hpc-status.html"><span class="header-section-number">7</span> HPC status</a></li>
<li><a class="" href="poster.html"><span class="header-section-number">8</span> Poster</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/TengMCing/analysis_buffer">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="hpc-m3-documentation" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> HPC (M3) Documentation<a class="anchor" aria-label="anchor" href="#hpc-m3-documentation"><i class="fas fa-link"></i></a>
</h1>
<p>This is a chapter for documenting the use of HPC in terms of folder structure, model setup, tasks submission, etc.</p>
<div id="help-and-support" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Help and Support<a class="anchor" aria-label="anchor" href="#help-and-support"><i class="fas fa-link"></i></a>
</h2>
<p>Encounter network issues? Check the system stauts on <a href="https://monasheresearch.statuspage.io/" class="uri">https://monasheresearch.statuspage.io/</a>.</p>
<p>Send email to <a href="mailto:help@massive.org.au" class="email">help@massive.org.au</a> with</p>
<ul>
<li>Commands</li>
<li>Simple reproducible example</li>
<li>Full path to <code>slurm</code> script and input files</li>
<li>Software used</li>
<li>Error messages</li>
</ul>
</div>
<div id="nodes-for-job-submission" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Nodes for Job Submission<a class="anchor" aria-label="anchor" href="#nodes-for-job-submission"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>K80</li>
<li>T4</li>
<li>P100</li>
<li>V100</li>
<li>A40</li>
<li>DGX1</li>
</ul>
</div>
<div id="remote-desktop" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Remote Desktop<a class="anchor" aria-label="anchor" href="#remote-desktop"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>P4: 60</li>
<li>T4: 32</li>
<li>Dual T4: 16</li>
<li>K80: 26</li>
<li>A40: 16</li>
</ul>
</div>
<div id="connection-methods" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Connection Methods<a class="anchor" aria-label="anchor" href="#connection-methods"><i class="fas fa-link"></i></a>
</h2>
<div id="ssh" class="section level3" number="6.4.1">
<h3>
<span class="header-section-number">6.4.1</span> ssh<a class="anchor" aria-label="anchor" href="#ssh"><i class="fas fa-link"></i></a>
</h3>
<pre><code>ssh -l username m3.massive.org.au</code></pre>
</div>
<div id="x11-port-forwarding" class="section level3" number="6.4.2">
<h3>
<span class="header-section-number">6.4.2</span> X11 port forwarding<a class="anchor" aria-label="anchor" href="#x11-port-forwarding"><i class="fas fa-link"></i></a>
</h3>
<p>Trusted X11 forwarding</p>
<pre><code>ssh -l username m3.massive.org.au -Y</code></pre>
<p>Enables X11 forwarding</p>
<pre><code>ssh -l username m3.massive.org.au -X</code></pre>
</div>
</div>
<div id="remote-desktop-1" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> Remote Desktop<a class="anchor" aria-label="anchor" href="#remote-desktop-1"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Strudel Web (<a href="http://desktop.massive.org.au/" class="uri">http://desktop.massive.org.au/</a>)</li>
<li>Strudel2 (<a href="https://beta.desktop.cvl.org.au/login" class="uri">https://beta.desktop.cvl.org.au/login</a>)
<ul>
<li>Use P4 or single-T4. They both have single GPU, which is easier to be used.</li>
</ul>
</li>
</ul>
<p>Great for setting up the environment interactively.</p>
<div id="change-the-size-of-the-desktop" class="section level3" number="6.5.1">
<h3>
<span class="header-section-number">6.5.1</span> Change the Size of the Desktop<a class="anchor" aria-label="anchor" href="#change-the-size-of-the-desktop"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Use <code>xrandr -s "1920 * 1080"</code> in the desktop terminal.</li>
<li>Use TurboVNC (<code>ctl-cmd-shift-o</code>?), under “Connection Option”</li>
</ul>
</div>
<div id="connection-speed" class="section level3" number="6.5.2">
<h3>
<span class="header-section-number">6.5.2</span> Connection Speed<a class="anchor" aria-label="anchor" href="#connection-speed"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Use “WAN” options under “Encoding method” of TurboVNC</li>
</ul>
</div>
<div id="others" class="section level3" number="6.5.3">
<h3>
<span class="header-section-number">6.5.3</span> Others<a class="anchor" aria-label="anchor" href="#others"><i class="fas fa-link"></i></a>
</h3>
<p>The remote machine may have copy and paste keys different from your local machine.
- You can not copy and paste with the Mac keyboard!</p>
</div>
<div id="jupyter-lab" class="section level3" number="6.5.4">
<h3>
<span class="header-section-number">6.5.4</span> Jupyter Lab<a class="anchor" aria-label="anchor" href="#jupyter-lab"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Disable pop-up blocker</li>
<li>Install user site package <code>pip install --user pkg_name</code>
</li>
<li>Or <code>!pip install --user pkg_name</code>
</li>
<li>Or create a conda env/venv</li>
<li><code>pip list installed</code></li>
</ul>
</div>
<div id="login-node-vs.-compute-node" class="section level3" number="6.5.5">
<h3>
<span class="header-section-number">6.5.5</span> Login Node VS. Compute Node<a class="anchor" aria-label="anchor" href="#login-node-vs.-compute-node"><i class="fas fa-link"></i></a>
</h3>
<p>Login node is for editing scripts and submitting jobs.
- You can also install packages with this node.</p>
</div>
<div id="use-miniconda" class="section level3" number="6.5.6">
<h3>
<span class="header-section-number">6.5.6</span> Use Miniconda<a class="anchor" aria-label="anchor" href="#use-miniconda"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://docs.massive.org.au/M3/software/pythonandconda/python-miniconda.html#python-miniconda" class="uri">https://docs.massive.org.au/M3/software/pythonandconda/python-miniconda.html#python-miniconda</a></p>
<pre><code>module load conda-install

# Install miniconda to default space (/scratch/sk54/username/miniconda)
conda-install

# Init conda (modify .bashrc)
/scratch/sk54/wlii0039/miniconda/bin/conda init

# Create env (Note that there is an environment called jupyterlab that can be used)
conda create --name myenv -f myenv.yml

conda activate myenv</code></pre>
<pre><code>conda install pkg_name=ver_num

conda update pkg_name=ver_num</code></pre>
<div id="add-new-env-to-jupyterlab" class="section level4" number="6.5.6.1">
<h4>
<span class="header-section-number">6.5.6.1</span> Add New Env to JupyterLab<a class="anchor" aria-label="anchor" href="#add-new-env-to-jupyterlab"><i class="fas fa-link"></i></a>
</h4>
<pre><code>add-strudel2-conda /path/to/miniconda/ newJupyterEnv</code></pre>
</div>
</div>
<div id="vs-code-connection" class="section level3" number="6.5.7">
<h3>
<span class="header-section-number">6.5.7</span> VS Code Connection<a class="anchor" aria-label="anchor" href="#vs-code-connection"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://docs.massive.org.au/M3/connecting/strudel2/connecting-to-vscode.html" class="uri">https://docs.massive.org.au/M3/connecting/strudel2/connecting-to-vscode.html</a></p>
</div>
</div>
<div id="useful-commands" class="section level2" number="6.6">
<h2>
<span class="header-section-number">6.6</span> Useful commands<a class="anchor" aria-label="anchor" href="#useful-commands"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><code>user_info</code></li>
<li><code>show_job</code></li>
<li><code>show_cluster</code></li>
<li>
<code>nvidia-smi</code> (after cuda and cudnn module loaded)</li>
</ul>
</div>
<div id="file-systems" class="section level2" number="6.7">
<h2>
<span class="header-section-number">6.7</span> File systems<a class="anchor" aria-label="anchor" href="#file-systems"><i class="fas fa-link"></i></a>
</h2>
<p>Two symbolic links:
- <code>~/project_name</code>: backed up daily
- <code>~/project_name_scratch</code>: not backed up</p>
<div id="space" class="section level3" number="6.7.1">
<h3>
<span class="header-section-number">6.7.1</span> Space<a class="anchor" aria-label="anchor" href="#space"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Home (10GB)
<ul>
<li>Configuration files</li>
<li>Personal settings</li>
</ul>
</li>
<li>Project (50GB? 500GB?)
<ul>
<li>Input data</li>
<li>Job scripts</li>
<li>Output data</li>
<li>Create a subdirectory for myself (e.g. “~/project/patrickli”)</li>
</ul>
</li>
<li>Scratch (3TB)
<ul>
<li>Intermediate data</li>
<li>Data that is actively being processed</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="filezilla" class="section level2" number="6.8">
<h2>
<span class="header-section-number">6.8</span> FileZilla<a class="anchor" aria-label="anchor" href="#filezilla"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>Site-Manager</li>
<li>New Site (SFTP)</li>
</ol>
<ul>
<li>Host: m3-dtn.massive.org.au</li>
<li>Logon Type: Ask for Password</li>
<li>User: my_username</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Enter password</li>
</ol>
</div>
<div id="modules" class="section level2" number="6.9">
<h2>
<span class="header-section-number">6.9</span> Modules<a class="anchor" aria-label="anchor" href="#modules"><i class="fas fa-link"></i></a>
</h2>
<pre><code>module avail mod_name

# To use a module
module load mod_name

# Loaded module
module list

# Learn more
module show mod_name

module unload mod_name

# Kill all loaded modules
module purge</code></pre>
</div>
<div id="jobs" class="section level2" number="6.10">
<h2>
<span class="header-section-number">6.10</span> Jobs<a class="anchor" aria-label="anchor" href="#jobs"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://slurm.schedmd.com/" class="uri">https://slurm.schedmd.com/</a></p>
<p><code>show_cluster</code></p>
<div id="slurm-accounts" class="section level3" number="6.10.1">
<h3>
<span class="header-section-number">6.10.1</span> Slurm Accounts<a class="anchor" aria-label="anchor" href="#slurm-accounts"><i class="fas fa-link"></i></a>
</h3>
<p><code>sacctmgr show user $USER format=User,DefaultAccount</code></p>
</div>
<div id="job-submission" class="section level3" number="6.10.2">
<h3>
<span class="header-section-number">6.10.2</span> Job Submission<a class="anchor" aria-label="anchor" href="#job-submission"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://docs.massive.org.au/M3/slurm/simple-batch-jobs.html" class="uri">https://docs.massive.org.au/M3/slurm/simple-batch-jobs.html</a></p>
<ul>
<li><code>sbatch jobs.script</code></li>
<li><code>scancel job_id</code></li>
</ul>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="plan.html"><span class="header-section-number">5</span> Plan</a></div>
<div class="next"><a href="hpc-status.html"><span class="header-section-number">7</span> HPC status</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#hpc-m3-documentation"><span class="header-section-number">6</span> HPC (M3) Documentation</a></li>
<li><a class="nav-link" href="#help-and-support"><span class="header-section-number">6.1</span> Help and Support</a></li>
<li><a class="nav-link" href="#nodes-for-job-submission"><span class="header-section-number">6.2</span> Nodes for Job Submission</a></li>
<li><a class="nav-link" href="#remote-desktop"><span class="header-section-number">6.3</span> Remote Desktop</a></li>
<li>
<a class="nav-link" href="#connection-methods"><span class="header-section-number">6.4</span> Connection Methods</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ssh"><span class="header-section-number">6.4.1</span> ssh</a></li>
<li><a class="nav-link" href="#x11-port-forwarding"><span class="header-section-number">6.4.2</span> X11 port forwarding</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#remote-desktop-1"><span class="header-section-number">6.5</span> Remote Desktop</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#change-the-size-of-the-desktop"><span class="header-section-number">6.5.1</span> Change the Size of the Desktop</a></li>
<li><a class="nav-link" href="#connection-speed"><span class="header-section-number">6.5.2</span> Connection Speed</a></li>
<li><a class="nav-link" href="#others"><span class="header-section-number">6.5.3</span> Others</a></li>
<li><a class="nav-link" href="#jupyter-lab"><span class="header-section-number">6.5.4</span> Jupyter Lab</a></li>
<li><a class="nav-link" href="#login-node-vs.-compute-node"><span class="header-section-number">6.5.5</span> Login Node VS. Compute Node</a></li>
<li><a class="nav-link" href="#use-miniconda"><span class="header-section-number">6.5.6</span> Use Miniconda</a></li>
<li><a class="nav-link" href="#vs-code-connection"><span class="header-section-number">6.5.7</span> VS Code Connection</a></li>
</ul>
</li>
<li><a class="nav-link" href="#useful-commands"><span class="header-section-number">6.6</span> Useful commands</a></li>
<li>
<a class="nav-link" href="#file-systems"><span class="header-section-number">6.7</span> File systems</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#space"><span class="header-section-number">6.7.1</span> Space</a></li></ul>
</li>
<li><a class="nav-link" href="#filezilla"><span class="header-section-number">6.8</span> FileZilla</a></li>
<li><a class="nav-link" href="#modules"><span class="header-section-number">6.9</span> Modules</a></li>
<li>
<a class="nav-link" href="#jobs"><span class="header-section-number">6.10</span> Jobs</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#slurm-accounts"><span class="header-section-number">6.10.1</span> Slurm Accounts</a></li>
<li><a class="nav-link" href="#job-submission"><span class="header-section-number">6.10.2</span> Job Submission</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/TengMCing/analysis_buffer/blob/master/05-HPC.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/TengMCing/analysis_buffer/edit/master/05-HPC.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Analysis Buffer</strong>" was written by Patrick Li. It was last built on 2023-08-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
